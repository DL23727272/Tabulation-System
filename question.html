<!DOCTYPE html>
<html>
<head>
    <title>Q&A</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css"/>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/alertifyjs@1.13.1/build/css/alertify.min.css"/>
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/alertifyjs@1.13.1/build/css/themes/bootstrap.min.css"/>
    <script src="//cdn.jsdelivr.net/npm/alertifyjs@1.13.1/build/alertify.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@10"></script>
    <link rel="icon" type="image/x-icon" href="/img/logo.ico">
    <style>
        body {
            background-color: #000000;
        }
        .thumb {
            display: flex;
            margin-top: -60px;
            justify-content: center;
        }
        .thumb a:hover {
            margin-top: -15px;
            transition: 0.2s;
        }
        .thumb img {
            width: 54px;
            margin: 20px 20px 0 10px;
            max-height: 100%;
        }
        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 20px;
        }
        ::-webkit-scrollbar-track {
            box-shadow: inset 0 0 5px grey; 
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb {
            background: #8284ea; 
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #b30000; 
        }
        /* END OF Scrollbar */
        .navbar {
            background-color: #8284ea; 
            transition: background-color 0.3s ease; 
        }
        .navbar.blurred {
            background-color: transparent;
            backdrop-filter: blur(20px);
        }
        .nav-link {
            color: white;
            font-weight: 500;
            transition: color 0.3s ease 
        }
        .nav-link.scrolled {
            color: #ffffff;
            font-weight: 500;
        }
        .nav-link.scrolled:hover {
            color: #006341; 
            font-weight: 500;
        }
        #mugIcon {
            color: white;
            transition: color 0.3s ease;
        }
        #mugIcon.scrolled {
            color: #000000;
        }
        #fruitimage {
            max-width: 100%;
            max-height: 300px; 
        }
        
    </style>
</head>
<body class="">
    <!--Navbar-->
    <nav class="navbar navbar-expand-lg shadow-lg sticky-top" id="navbar">
        <div class="container-sm d-flex justify-content-between" style="width: 100%">
            <div class="d-flex justify-content-between align-items-center" style="width: 100vw">
                <div>
                    <a href="#"> <img src="./img/logo.png" alt="" style="width:60px" /></a>
                </div>
                <div>
                    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent">
                        <i class="fa-solid fa-bars" id="mugIcon"></i>
                    </button>
                </div>
            </div>

            <div class="collapse navbar-collapse container-fluid" id="navbarSupportedContent" style="width: 35vw">
                <ul class="navbar-nav mb-2 mb-lg-0">
                    <li class="nav-item">
                        <a class="nav-link " aria-current="page" href="home.html">
                            Home
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link  " href="denim.html">
                            Denim
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link " href="sports.html">
                            Sportswear
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link " href="swimsuit.html">
                            Swimsuit
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link " href="formal.html">
                            Formal 
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link " href="question.html">
                            Q&A 
                        </a>
                    </li>
                    <li class="nav-item">
                      <a class="nav-link " href="index.html">
                        <i class="fa-solid fa-power-off"></i>
                      </a>
                    </li>
                </ul>
            </div>
            
        </div>
    </nav>
    <!--End Navbar -->

    <!-- MODAL ADD ITEMS -->
    <div id="modalContainer"></div>
    <!-- END MODAL ADD ITEMS -->

    <!--Banner-->
    <div>
        <div class="position-relative">
            <img src="./img/bg.png" class="w-100 img-fluid" style="height: 100vh; object-fit: cover; filter: blur(4px); filter: saturate(2);" />
        </div>
    </div>
    <!--End Banner-->

    <hr class="container-sm Sborder border-success mt-5 border-2 opacity-50" />

    <!-- Question and Answer CONTENT -->
    <section class="">
        <div class="container-sm">
            <div id="question">
                <h1 class="fst-italic text-center text-white">Judge No. <span id="judgeID">0</span></h1>
                <h1 class="fst-italic text-center text-white"> <span id="judgeName"></span></h1>
                <h1 class="fst-italic text-center text-white">Question and Answer</h1>
                <h2 class="fst-bold text-center text-white">(60 Points)</h2>

                <div class="container mt-5">
                    <table id="QuestionMale" class="table table-bordered">
                        <thead>
                            <tr>
                                <th colspan="3" class="table-header text-center bg-primary">MALE</th>
                            </tr>
                            <tr>
                                <th class="table-header">CANDIDATE</th>
                                <th class="table-header">SCORE</th>
                                <th class="table-rank-header">RANK</th>
                            </tr>
                        </thead>
                        <tbody id="maleContestants">
                        </tbody>
                    </table>
                    <div class="col align-self-end">
                       <button type="button" class="btn btn-primary" onclick="submitScores('male')">Submit</button>
                    </div>
                    
                </div>

                <div class="container mt-5">
                    <table id="QuestionFemale" class="table table-bordered">
                        <thead>
                            <tr>
                                <th colspan="3" class="table-header text-center bg-primary">FEMALE</th>
                            </tr>
                            <tr>
                                <th class="table-header">CANDIDATE</th>
                                <th class="table-header">SCORE</th>
                                <th class="table-rank-header">RANK</th>
                            </tr>
                        </thead>
                        <tbody id="femaleContestants">
                      
                        </tbody>
                    </table>
                    <div class="col align-self-end">
                       <button type="button" class="btn btn-primary" onclick="submitScores('female')">Submit</button>
                    </div>
                    
                </div>

            </div>
        </div>
    </section>
   
    <!-- End Sportswear CONTENT -->

    <hr class="container-sm Sborder border-success mt-5 border-2 opacity-50" />

    <!---Footer-->
    <footer class="mt-5 text-white p-3" style="background-color: #000000;">
        <div class="container-sm d-flex justify-content-between align-items-center">
            <div class="">
            <h4>Tabulation System</h4>
            <h5>DL VISUALS</h5>
            <ul>
                <li>Dran Leynard Gamoso</li>
                <li><a href="https://www.facebook.com/DLuvvsssU" style="text-decoration: none; color:white"><i class="fa-brands fa-facebook"></i> Facebook</a></li>
            </ul>
            </div>
            <div class="">
            <div>
                <img src="./img/logo.png" style=" width: 50px; height: 50px;" alt="">
            </div>
            <div>
                <p class="fst-bold">&copy DL Visuals</p>
            </div>
            </div>
        </div>
    </footer>
    <!---End Footer-->
    <script>
    //For navbar
    window.onscroll = function () { scrollFunction() };

    function scrollFunction() {
    if (document.body.scrollTop > 50 || document.documentElement.scrollTop > 50) {
        document.getElementById("navbar").classList.add("blurred");
        const navLinks = document.querySelectorAll(".nav-link");
        navLinks.forEach(link => link.classList.add("scrolled"));
        document.getElementById("mugIcon").classList.add("scrolled"); 
    } else {
        document.getElementById("navbar").classList.remove("blurred");
        const navLinks = document.querySelectorAll(".nav-link");
        navLinks.forEach(link => link.classList.remove("scrolled"));
        document.getElementById("mugIcon").classList.remove("scrolled");
    }
    }
    //end of function for navbarrr

        function submitScores(gender) {
            let judgeId = document.getElementById('judgeID').innerText;
        
            let data = [];
            let rows = document.querySelectorAll(`#Question${gender.charAt(0).toUpperCase() + gender.slice(1)} .table-data`);
            
            let isEmpty = false;
            
            rows.forEach(row => {
                let candidate = row.children[0].innerText;
                let score = row.children[1].children[0].value.trim(); 
                let rank = row.children[2].innerText;
                
                if (score === '') {
                    isEmpty = true;
                    return false; 
                }
                
                data.push({candidate: candidate, score: score, rank: rank});
            });
            
            if (isEmpty) {
                Swal.fire({
                    icon: 'error',
                    title: 'Empty Fields',
                    text: 'Please fill in all the score fields before submitting.'
                });
                return;
            }
            rows.forEach(row => {
                row.children[1].children[0].disabled = true;
            });
            $.ajax({
                url: './backend/questionProcess.php',
                type: 'POST',
                data: {
                    gender: gender,
                    judgeId: judgeId, 
                    data: JSON.stringify(data)
                },
                dataType: 'json',
                success: function(response) {
                    if (response.status === 'success') {
                        Swal.fire({
                            icon: 'success',
                            title: response.message,
                            showConfirmButton: false,
                            timer: 2000 
                        });
                    } else {
                        Swal.fire({
                            icon: 'error',
                            title: 'Error',
                            text: response.message
                        });
                    }
                },
                error: function(xhr, status, error) {
                    Swal.fire({
                        icon: 'error',
                        title: 'Error',
                        text: 'An error occurred while processing your request. Please try again.'
                    });
                }
            });
        }
        
        
        $(document).ready(function() {
            function updateRanks(tableId) {
                let table = $(tableId);
                let rows = table.find('tbody tr');
                let scores = [];
                
                rows.each(function() {
                    let score = parseFloat($(this).find('.score-input').val());
                    scores.push({ row: $(this), score: score });
                });
                
                // Sort scores by descending order
                scores.sort((a, b) => b.score - a.score);
                
                let rank = 1;
                
                scores.forEach((item, index) => {
                    if (index > 0 && item.score === scores[index - 1].score) {
                        item.row.find('.table-rank').text(rank);
                    } else {
                        item.row.find('.table-rank').text(rank++);
                    }
                });
            }
            
            $('.score-input').on('input', function() {
                let tableId = $(this).closest('table').attr('id');
                updateRanks('#' + tableId);
            });
            
            $('.btn-primary').click(function() {
                let tableId = $(this).closest('table').attr('id');
                updateRanks('#' + tableId);
              //  alertify.success('Scores and ranks updated successfully.');
            });
        });
        
        

        document.addEventListener("DOMContentLoaded", function() {
            var customerID = sessionStorage.getItem('customerID');
            var customerName = sessionStorage.getItem('customerName');
            var cartItems = JSON.parse(localStorage.getItem("cartItems")) || [];
            document.getElementById("judgeID").innerHTML = customerID;
            document.getElementById("judgeName").innerHTML = customerName;
            // Check if customerID is present
            if (customerID) {
              document.getElementById('customerID').innerText = 'Customer Name: ' + customerName;
              console.log('Customer ID ' + customerID)
              console.log('Customer Name ' + customerName);
              console.log(cartItems)
              document.getElementById("judgeID").innerHTML = customerID;
               
            } else {
                console.log('Customer ID not found in sessionStorage'); 
            }
        });



        //Ranking
        $(document).ready(function() {
            function updateRanks(tableId) {
                let table = $('#' + tableId);
                let rows = table.find('tbody tr');
                let scores = [];
        
                rows.each(function() {
                    let score = parseFloat($(this).find('.score-input').val());
                    scores.push({ row: $(this), score: score });
                });
        
                scores.sort((a, b) => b.score - a.score);
        
                let rank = 1;
        
                scores.forEach((item, index) => {
                    if (index > 0 && item.score === scores[index - 1].score) {
                        item.row.find('.table-rank').text(rank);
                    } else {
                        item.row.find('.table-rank').text(rank++);
                    }
                });
            }
        
            $(document).on('input', '.score-input', function() {
                let tableId = $(this).closest('table').attr('id');
                updateRanks(tableId);
            });
        
            $(document).on('click', '.btn-primary', function() {
                let tableId = $(this).closest('table').attr('id');
                updateRanks(tableId);
            });
        });


       // Function to fetch contestant data
        function fetchContestants() {
            fetch('./backend/fetchContestants.php')
                .then(response => response.json())
                .then(data => {
                    if (data.status === 'success') {
                        let maleTable = document.getElementById('QuestionMale');
                        let maleTbody = maleTable.querySelector('tbody');
                        if (maleTbody) {
                            let maleNumber = 1;
                            data.maleContestants.forEach((contestant, index) => {
                                let newRow = `
                                    <tr class="table-data">
                                        <td>M${maleNumber} - ${contestant.name}</td>
                                        <td><input type="text" class="score-input" placeholder="0.00"></td>
                                        <td class="table-rank">0</td>
                                    </tr>`;
                                maleTbody.insertAdjacentHTML('beforeend', newRow);
                                maleNumber++; 
                            });
                        } else {
                            console.error('Male contestants tbody not found');
                        }

                        let femaleTable = document.getElementById('QuestionFemale');
                        let femaleTbody = femaleTable.querySelector('tbody');
                        if (femaleTbody) {
                            let femaleNumber = 1; 
                            data.femaleContestants.forEach((contestant, index) => {
                                let newRow = `
                                    <tr class="table-data">
                                        <td>F${femaleNumber} - ${contestant.name}</td>
                                        <td><input type="text" class="score-input" placeholder="0.00"></td>
                                        <td class="table-rank">0</td>
                                    </tr>`;
                                femaleTbody.insertAdjacentHTML('beforeend', newRow);
                                femaleNumber++; 
                            });
                        } else {
                            console.error('Female contestants tbody not found');
                        }
                    } else {
                        console.error('Failed to fetch contestant data');
                    }
                })
                .catch(error => {
                    console.error('Error fetching contestant data:', error);
                    alert('Failed to fetch contestant data. Please try again later.');
                });
        }

        document.addEventListener('DOMContentLoaded', fetchContestants);

    </script>
</body>
</html>
